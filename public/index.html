<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M4GIX - Global Grid & Teleporter</title>
    <style>
        :root { 
            --accent: #00ff00; 
            --bg: #0a0a0a; 
            --card: #161616; 
            --text: #eee; 
            --local: #00d9ff; 
            --private: #ffaa00;
            --danger: #ff4444;
        }

        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            overflow-x: hidden;
        }
        
        .nav { 
            background: #111; 
            padding: 15px; 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            border-bottom: 2px solid var(--accent); 
            position: sticky; 
            top: 0; 
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .btn { 
            background: #222; 
            color: white; 
            border: 1px solid #444; 
            padding: 10px 25px; 
            cursor: pointer; 
            border-radius: 6px; 
            font-weight: bold; 
            transition: 0.2s;
        }

        .btn.active { background: var(--accent); color: black; border-color: var(--accent); }
        .btn:hover:not(.active) { border-color: var(--accent); }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 20px; 
            padding: 30px; 
        }
        
        .card { 
            background: var(--card); 
            border: 1px solid #333; 
            border-radius: 12px; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            transition: 0.2s; 
            position: relative;
        }

        .card.is-local { border: 2px solid var(--local); box-shadow: 0 0 15px rgba(0, 217, 255, 0.1); }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); }

        .income { 
            background: var(--accent); 
            color: black; 
            padding: 6px 12px; 
            border-radius: 6px; 
            font-weight: 900; 
            font-family: monospace; 
            font-size: 1.4em; 
            width: fit-content; 
            margin-bottom: 10px; 
        }

        .rarity { font-size: 0.8em; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .Legendary { color: #ffff55; } .Epic { color: #ff55ff; } .Rare { color: #5555ff; } .Common { color: #888; }
        
        .name { font-size: 1.3em; font-weight: bold; color: #fff; margin-bottom: 2px; }
        .mutation { color: #ff00ff; font-size: 0.85em; font-style: italic; margin-bottom: 12px; }
        
        .traits-list { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; min-height: 25px; }
        .trait-tag { background: rgba(0, 217, 255, 0.1); color: var(--local); font-size: 0.7em; padding: 3px 8px; border-radius: 4px; border: 1px solid rgba(0, 217, 255, 0.2); }

        .footer { 
            font-size: 0.85em; 
            color: #aaa; 
            margin-top: auto; 
            padding-top: 15px; 
            border-top: 1px solid #282828; 
            line-height: 1.6; 
        }

        .timestamp { color: var(--accent); font-weight: bold; display: block; margin-bottom: 8px; }
        
        .badge { font-size: 0.7em; padding: 3px 8px; border-radius: 4px; font-weight: bold; text-transform: uppercase; }
        .badge-user { background: #333; color: #fff; float: right; }
        .badge-local { background: var(--local); color: #000; float: right; }
        .badge-private { background: var(--private); color: #000; display: inline-block; margin-top: 5px; }
        .badge-public { background: #444; color: #fff; display: inline-block; margin-top: 5px; }
        
        .server-stats { margin: 10px 0; font-family: monospace; color: #888; font-size: 0.9em; }

        .btn-group { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; }
        
        .join-btn {
            padding: 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: bold; 
            text-align: center; 
            text-decoration: none; 
            font-size: 0.85em; 
            transition: 0.2s;
            border: 1px solid;
        }

        .btn-id { background: var(--accent); color: #000; border-color: var(--accent); }
        .btn-follow { background: transparent; color: var(--local); border-color: var(--local); }
        .btn-web { background: transparent; color: #666; border-color: #444; font-size: 0.75em; }
        
        .join-btn:hover { filter: brightness(1.2); }

        #status { align-self: center; font-size: 0.8em; font-weight: bold; }
    </style>
</head>
<body>

    <div class="nav">
        <button class="btn active" onclick="setFilter('ALL', this)">GLOBAL GRID</button>
        <button class="btn" onclick="setFilter('LOCAL', this)">MY ACCOUNTS</button>
        <div id="status">CONNECTING...</div>
    </div>

    <div id="grid" class="grid"></div>

    <script>
        let currentFilter = 'ALL';
        let brainrots = [];
        const gridElement = document.getElementById('grid');
        const statusElement = document.getElementById('status');

        const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
        const ws = new WebSocket(`${protocol}//${location.host}?role=Admin`);

        ws.onopen = () => { 
            statusElement.innerText = "‚óè LIVE"; 
            statusElement.style.color = "#00ff00"; 
        };
        ws.onclose = () => { 
            statusElement.innerText = "‚óè OFFLINE"; 
            statusElement.style.color = "#ff4444"; 
        };

        ws.onmessage = (event) => {
            const msg = JSON.parse(event.data);
            if (msg.type === 'REFRESH') {
                brainrots = msg.data;
                render();
            }
        };

        function timeAgo(dateString) {
            const now = new Date();
            const past = new Date(dateString);
            const diffSeconds = Math.floor((now - past) / 1000);
            if (diffSeconds < 10) return "√Ä l'instant";
            if (diffSeconds < 60) return `Il y a ${diffSeconds}s`;
            const mins = Math.floor(diffSeconds / 60);
            return `Il y a ${mins}m`;
        }

        function setFilter(f, btn) {
            currentFilter = f;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            render();
        }

        function render() {
            const filtered = currentFilter === 'LOCAL' 
                ? brainrots.filter(b => b.userType === 'LocalPlayer') 
                : brainrots;

            const now = new Date();
            const activeData = filtered.filter(b => (now - new Date(b.updatedAt)) < 600000);

            gridElement.innerHTML = activeData.map(b => {
                const s = b.server || { playerCount: 0, maxPlayers: 0, isPrivate: false };
                const isVeryOld = (now - new Date(b.updatedAt)) > 120000;

                return `
                <div class="card ${b.userType === 'LocalPlayer' ? 'is-local' : ''}" style="${isVeryOld ? 'opacity: 0.6' : ''}">
                    <div class="income">${b.incomeStr}</div>
                    <div class="rarity ${b.rarity}">${b.rarity}</div>
                    <div class="name">${b.name}</div>
                    <div class="mutation">‚ú® ${b.mutation}</div>
                    
                    <div class="traits-list">
                        ${b.traits && b.traits.length > 0 ? b.traits.map(t => `<span class="trait-tag">#${t}</span>`).join('') : '<span class="trait-tag" style="opacity:0.3">Aucun trait</span>'}
                    </div>

                    <div class="footer">
                        <span class="timestamp">‚è± ${timeAgo(b.updatedAt)}</span>
                        <span class="badge ${b.userType === 'LocalPlayer' ? 'badge-local' : 'badge-user'}">${b.userType}</span>
                        
                        üë§ <b>${b.ownerDisplayName}</b> (@${b.ownerName})<br>
                        
                        ${s.isPrivate ? '<span class="badge badge-private">üîí Serveur Priv√©</span>' : '<span class="badge badge-public">üåç Serveur Public</span>'}
                        
                        <div class="server-stats">
                            üë• Joueurs: ${s.playerCount}/${s.maxPlayers}<br>
                            üîë ID: <code>${b.jobId.substring(0,10)}...</code>
                        </div>

                        <div class="btn-group">
                            <a href="roblox://experiences/start?placeId=109983668079237&gameInstanceId=${b.jobId}" class="join-btn btn-id">
                                üöÄ REJOINDRE (JOB ID)
                            </a>

                            <a href="roblox://experiences/start?placeId=109983668079237&followUserId=${b.ownerId}" class="join-btn btn-follow">
                                üë• SUIVRE LE JOUEUR
                            </a>

                            <a href="https://www.roblox.com/games/start?placeId=109983668079237&instanceId=${b.jobId}" target="_blank" class="join-btn btn-web">
                                üåê VIA NAVIGATEUR
                            </a>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        setInterval(render, 10000);
    </script>
</body>
</html>
