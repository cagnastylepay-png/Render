<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>M4GIX TRACKER v2</title>
    <style>
        body { background: #0a0a0a; color: #eee; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .nav { background: #111; padding: 15px; border-bottom: 2px solid #0f0; text-align: center; position: sticky; top: 0; z-index: 100; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; padding: 25px; }
        .card { background: #161616; border: 1px solid #333; border-radius: 12px; padding: 20px; transition: 0.2s; position: relative; }
        .card:hover { border-color: #0f0; transform: translateY(-5px); }
        .income { background: #0f0; color: #000; font-weight: 900; padding: 8px 12px; border-radius: 6px; font-size: 1.2em; display: inline-block; margin-bottom: 10px; }
        .footer { margin-top: 15px; border-top: 1px solid #282828; padding-top: 15px; font-size: 0.85em; }
        .btn-group { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; }
        .btn { text-decoration: none; text-align: center; padding: 10px; border-radius: 6px; font-weight: bold; transition: 0.2s; border: 1px solid; }
        .btn-job { background: #0f0; color: #000; border-color: #0f0; }
        .btn-follow { color: #00d9ff; border-color: #00d9ff; }
        .btn:hover { filter: brightness(1.2); }
        .badge { font-size: 0.75em; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .badge-private { background: #ffaa00; color: #000; }
    </style>
</head>
<body>
    <div class="nav"><h2 style="margin:0; color:#0f0;">M4GIX GLOBAL TRACKER</h2></div>
    <div id="grid" class="grid"></div>

    <script>
        const grid = document.getElementById('grid');
        const ws = new WebSocket(`${location.protocol === 'https:' ? 'wss:' : 'ws:'}//${location.host}?role=Admin`);

        ws.onmessage = (e) => {
            const msg = JSON.parse(e.data);
            if (msg.type === 'REFRESH') render(msg.data);
        };

        function render(data) {
            grid.innerHTML = data.map(b => {
                const s = b.server || { playerCount: 0, maxPlayers: 0, isPrivate: false };
                return `
                <div class="card">
                    <div class="income">${b.incomeStr}</div>
                    <div style="font-size: 1.2em; font-weight: bold;">${b.name}</div>
                    <div style="color:#ff00ff; margin-bottom: 10px;">‚ú® ${b.mutation}</div>
                    
                    <div class="footer">
                        üë§ <b>${b.ownerDisplayName}</b> (@${b.ownerName})<br>
                        ${s.isPrivate ? '<span class="badge badge-private">üîí PRIV√â</span>' : '<span>üåç PUBLIC</span>'} 
                        | üë• ${s.playerCount}/${s.maxPlayers}
                        
                        <div class="btn-group">
                            <a href="roblox://experiences/start?placeId=109983668079237&gameInstanceId=${b.jobId}" class="btn btn-job">REJOINDRE (JOB ID)</a>
                            <a href="roblox://experiences/start?placeId=109983668079237&followUserId=${b.ownerId}" class="btn btn-follow">üë• SUIVRE LE JOUEUR</a>
                        </div>
                    </div>
                </div>
            `}).join('');
        }
    </script>
</body>
</html>
